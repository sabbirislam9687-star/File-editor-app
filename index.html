<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶´‡¶æ‡¶á‡¶≤ ‡¶è‡¶°‡¶ø‡¶ü‡¶∞</title>
    <meta name="theme-color" content="#007bff">
    <meta name="description" content="‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶è‡¶°‡¶ø‡¶ü‡¶∞">
    
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìù</text></svg>">
    
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .app-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            max-width: 100%;
            background: white;
            margin: 10px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .app-header {
            background: #007bff;
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .app-title {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .app-subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-top: 5px;
        }

        .install-btn {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            backdrop-filter: blur(10px);
            display: none;
        }

        .install-btn.active {
            display: block;
        }

        .app-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px;
        }

        .file-info {
            background: #f8f9fa;
            padding: 12px 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #007bff;
            display: none;
        }

        .file-info.active {
            display: block;
        }

        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        button {
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-new {
            background: #28a745;
            color: white;
        }

        .btn-open {
            background: #007bff;
            color: white;
        }

        .btn-save {
            background: #6c757d;
            color: white;
            grid-column: span 2;
        }

        .btn-save.active {
            background: #dc3545;
        }

        button:active {
            transform: scale(0.95);
        }

        #file-content {
            flex: 1;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
            font-size: 16px;
            font-family: 'Courier New', monospace;
            resize: none;
            margin-bottom: 15px;
        }

        #file-content:focus {
            border-color: #007bff;
            outline: none;
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            background: #f8f9fa;
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 0.9rem;
        }

        .unsaved-changes {
            color: #dc3545;
            font-weight: bold;
        }

        .offline-indicator {
            background: #ffc107;
            color: #856404;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            display: none;
        }

        .offline-indicator.active {
            display: block;
        }

        /* ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶Ö‡¶™‡ßç‡¶ü‡¶ø‡¶Æ‡¶æ‡¶á‡¶ú‡ßá‡¶∂‡¶® */
        @media (max-width: 480px) {
            .app-container {
                margin: 5px;
                border-radius: 10px;
            }
            
            .app-header {
                padding: 15px;
            }
            
            .app-title {
                font-size: 1.3rem;
            }
            
            .controls {
                grid-template-columns: 1fr;
            }
            
            .btn-save {
                grid-column: span 1;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <div>
                <div class="app-title">üìù ‡¶´‡¶æ‡¶á‡¶≤ ‡¶è‡¶°‡¶ø‡¶ü‡¶∞</div>
                <div class="app-subtitle">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶ï‡ßç‡¶§‡¶ø‡¶ó‡¶§ ‡¶®‡ßã‡¶ü ‡¶è‡¶™</div>
            </div>
            <button id="install-btn" class="install-btn">‡¶á‡¶®‡ßç‡¶∏‡¶ü‡¶≤</button>
        </header>
        
        <main class="app-content">
            <div class="file-info" id="file-info">
                <strong>‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶´‡¶æ‡¶á‡¶≤:</strong> <span id="file-name">-</span> 
                (<span id="file-size">-</span>)
            </div>
            
            <div class="controls">
                <button id="new-btn" class="btn-new">
                    <span>üÜï</span> ‡¶®‡¶§‡ßÅ‡¶®
                </button>
                <button id="open-btn" class="btn-open">
                    <span>üìÇ</span> ‡¶ì‡¶™‡ßá‡¶®
                </button>
                <button id="save-btn" class="btn-save">
                    <span>üíæ</span> ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®
                </button>
            </div>
            
            <textarea id="file-content" placeholder="‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..."></textarea>
            
            <div class="status-bar">
                <div id="char-count">‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞: 0</div>
                <div class="offline-indicator" id="offline-indicator">‡¶Ö‡¶´‡¶≤‡¶æ‡¶á‡¶®</div>
                <div id="unsaved-indicator" class="unsaved-changes" style="display: none;">* ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡¶®‡¶ø</div>
            </div>
        </main>
    </div>

    <script>
        // PWA ‡¶á‡¶®‡ßç‡¶∏‡¶ü‡¶≤‡ßá‡¶∂‡¶®
        let deferredPrompt;
        const installBtn = document.getElementById('install-btn');
        
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installBtn.classList.add('active');
        });
        
        installBtn.addEventListener('click', async () => {
            if (!deferredPrompt) return;
            
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            
            if (outcome === 'accepted') {
                installBtn.classList.remove('active');
            }
            
            deferredPrompt = null;
        });
        
        // ‡¶Ö‡¶´‡¶≤‡¶æ‡¶á‡¶® ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏
        const offlineIndicator = document.getElementById('offline-indicator');
        
        window.addEventListener('online', () => {
            offlineIndicator.classList.remove('active');
        });
        
        window.addEventListener('offline', () => {
            offlineIndicator.classList.add('active');
        });
        
        if (!navigator.onLine) {
            offlineIndicator.classList.add('active');
        }
        
        // ‡¶´‡¶æ‡¶á‡¶≤ ‡¶è‡¶°‡¶ø‡¶ü‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡¶æ‡¶≤‡¶ø‡¶ü‡¶ø
        const newBtn = document.getElementById('new-btn');
        const openBtn = document.getElementById('open-btn');
        const saveBtn = document.getElementById('save-btn');
        const contentArea = document.getElementById('file-content');
        const fileInfo = document.getElementById('file-info');
        const fileName = document.getElementById('file-name');
        const fileSize = document.getElementById('file-size');
        const charCount = document.getElementById('char-count');
        const unsavedIndicator = document.getElementById('unsaved-indicator');
        
        let fileHandle = null;
        let hasUnsavedChanges = false;
        
        // ‡¶®‡¶§‡ßÅ‡¶® ‡¶´‡¶æ‡¶á‡¶≤
        function newFile() {
            contentArea.value = '';
            fileHandle = null;
            updateFileInfo('-', '-');
            updateCharCount();
            hasUnsavedChanges = false;
            updateUI();
            contentArea.focus();
        }
        
        // ‡¶´‡¶æ‡¶á‡¶≤ ‡¶ì‡¶™‡ßá‡¶®
        async function openFile() {
            if (!('showOpenFilePicker' in window)) {
                alert('‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞ ‡¶´‡¶æ‡¶á‡¶≤ ‡¶ì‡¶™‡ßá‡¶® ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡ßá ‡¶®‡¶æ‡•§ ‡¶®‡¶§‡ßÅ‡¶® ‡¶´‡¶æ‡¶á‡¶≤ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
                return;
            }
            
            try {
                if (hasUnsavedChanges && !confirm('‡¶∏‡ßá‡¶≠ ‡¶®‡¶æ ‡¶ï‡¶∞‡¶æ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶π‡¶æ‡¶∞‡¶ø‡¶Ø‡¶º‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá‡•§ ‡¶ö‡¶≤‡¶¨‡ßá?')) {
                    return;
                }
                
                [fileHandle] = await window.showOpenFilePicker({
                    types: [{
                        description: 'Text Files',
                        accept: {'text/plain': ['.txt']},
                    }],
                    multiple: false,
                });

                const file = await fileHandle.getFile();
                const content = await file.text();
                contentArea.value = content;
                
                updateFileInfo(file.name, formatFileSize(file.size));
                hasUnsavedChanges = false;
                updateUI();
                
            } catch (error) {
                console.log('File open cancelled');
            }
        }
        
        // ‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡ßá‡¶≠
        async function saveFile() {
            try {
                if (!('showSaveFilePicker' in window)) {
                    // ‡¶´‡¶æ‡¶á‡¶≤ ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®
                    downloadFile(contentArea.value, 'my-file.txt');
                    hasUnsavedChanges = false;
                    updateUI();
                    return;
                }
                
                if (!fileHandle) {
                    fileHandle = await window.showSaveFilePicker({
                        types: [{
                            description: 'Text Files',
                            accept: {'text/plain': ['.txt']},
                        }],
                    });
                }

                const writableStream = await fileHandle.createWritable();
                await writableStream.write(contentArea.value);
                await writableStream.close();

                updateFileInfo(fileHandle.name, formatFileSize(contentArea.value.length));
                hasUnsavedChanges = false;
                updateUI();
                
                alert('‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
                
            } catch (error) {
                console.log('File save cancelled');
            }
        }
        
        // ‡¶´‡¶æ‡¶á‡¶≤ ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶°
        function downloadFile(content, filename) {
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        // ‡¶π‡ßá‡¶≤‡ßç‡¶™‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
        function updateFileInfo(name, size) {
            fileName.textContent = name;
            fileSize.textContent = size;
            fileInfo.classList.toggle('active', name !== '-');
        }
        
        function updateCharCount() {
            charCount.textContent = `‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞: ${contentArea.value.length}`;
        }
        
        function updateUI() {
            saveBtn.disabled = !hasUnsavedChanges && contentArea.value.trim() === '';
            saveBtn.classList.toggle('active', hasUnsavedChanges);
            unsavedIndicator.style.display = hasUnsavedChanges ? 'block' : 'none';
        }
        
        function formatFileSize(bytes) {
            if (typeof bytes === 'string') bytes = bytes.length;
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / 1048576).toFixed(1) + ' MB';
        }
        
        // ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü ‡¶≤‡¶ø‡¶∏‡ßá‡¶®‡¶æ‡¶∞
        newBtn.addEventListener('click', newFile);
        openBtn.addEventListener('click', openFile);
        saveBtn.addEventListener('click', saveFile);
        
        contentArea.addEventListener('input', () => {
            updateCharCount();
            hasUnsavedChanges = true;
            updateUI();
        });
        
        // ‡¶ï‡ßÄ‡¶¨‡ßã‡¶∞‡ßç‡¶° ‡¶∂‡¶∞‡ßç‡¶ü‡¶ï‡¶æ‡¶ü
        document.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                e.preventDefault();
                saveFile();
            }
        });
        
        // ‡¶∂‡ßÅ‡¶∞‡ßÅ‡¶§‡ßá ‡¶´‡ßã‡¶ï‡¶æ‡¶∏
        contentArea.focus();
    </script>
</body>
</html>